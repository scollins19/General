---
title: "MA461 Assignment 1"
author: "Sarah Collins"
date: "31 January 2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### <b> Q1  Which, if any, of these transition probability matrices does not come from a reversible Markov Chain </b>

```{r}
library(expm)
```


```{r}
P=matrix(c(0.6,0.7,0.4,0.3),2,2)
P1 = matrix(c(0.422,0.208,0.578,0.792),2,2)
P2 = matrix(c(0.4,0.2,0.6,0.3,0.1,0.1,0.3,0.7,0.3),3,3)
```

<b> (i) </b>

```{r}
V=eigen(t(P))$vectors[,1] #Get eigen vector

pi=V/(sum(V)) #Rescale to get probabilities where lambda = 1 (col 1) 

R= matrix(c(0,0,0,0),2,2) #make empty matrix

for(i in 1:2){
  for(j in 1:2){
    # A Markov chain in reverse can be defined as:  <b> Pij = (pi_j/ pi_i)* Pji </b>,
    # where pi is the stationary distribution of the vector and Pij are the entries 
    # of the TPM for the forward chain
    # If the Markov chain is symmetric, then the forward and reverse TPMs should be
    #identical 
    R[i,j]=(pi[j]/pi[i])*P[j,i] 
  }
}
P
R

```
This chain is reversible 


<b> (ii) </b>
```{r}

V1=eigen(t(P1))$vectors[,1]
R1= matrix(c(0,0,0,0),2,2)
pi=V1/(sum(V1))

for(i in 1:2){
  for(j in 1:2){
    R1[i,j]=(pi[j]/pi[i])*P1[j,i]
  }
}
P1
R1
```

This chain is reversible

<b> (iii) </b>

```{r}
V2=eigen(t(P2))$vectors[,1]
R2= matrix(c(0,0,0,0,0,0,0,0,0),3,3)
pi=V2/(sum(V2))

for(i in 1:3){
  for(j in 1:3){
    R2[i,j]=(pi[j]/pi[i])*P2[j,i]
  }
}
P2
R2
```

As the reverse TPM of this matrix does not match the forward, the chain is not reversible.


---


#### <b> Q6 What is the probability that X1 = A? </b>

```{r}
p = matrix(c(.4,.3,.2,.15,.2,.2,.5,.05,.1,.45,.15,.2,.3,.05,.15,.6),4,4)
colnames(p) <- c("A","C","G","T")
rownames(p) <- c("A","C","G","T")


v=eigen(t(p))$vectors[,1]
pi=v/(sum(v))


#If X1 is not the inital state
#Get reverse TPM
r= matrix(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),4,4)
colnames(r) <- c("A","C","G","T")
rownames(r) <- c("A","C","G","T")

for(i in 1:4){
  for(j in 1:4){
    r[i,j]=(pi[j]/pi[i])*p[j,i]
  }
}

# Probability of going from i to j where nsteps = 2
#(TPM%^%2)["i","j"]
#Going backwards so use reverse TPM from X3=A to X1=A:
(r%^%2)["A","A"]
```


---



#### <b> Q7 Suppose the above Markov chain models the nucleotide present at some position of a genome, sampled at regular intervals of evolutionary time in the forward-time direction.  Use a maximum likelihood approach to decide whether the sequence below,  derived from a realisation of the evolutionary model, corresponds to evolution forwards or backwards in time. </b>

```{r}
n= c('A','C','C','G','T','A')

#Forward Direction
ll_f = log(pi[1])
for(i in 1:(length(n)-1)){
  ll_f = ll_f + log(p[n[i],n[i+1]])
}

#Reverse Direction
ll_r = log(pi[1])
for(i in 1:(length(n)-1)){
  ll_r = ll_r + log(r[n[i],n[i+1]])
}

ll_f
ll_r
```

As the log liklihood score of the sequence is larger in the reverse direction, we can say that the sequence corresponds to evolution reverse in time. 



